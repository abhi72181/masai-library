<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .modaledit {
          box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px,
            rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
          width: 800px;
          margin: auto;
          display: none;
        }
        .modaledit form {
          display: flex;
          flex-wrap: wrap;
          border: "2px solid black";
          padding: 10px;
          margin: 10px;
        }
        .modaledit form input {
          margin: 10px;
        }
        .exit {
          position: relative;
          left: 97%;
          padding: 5px;
          color: red;
          background-color: white;
          border: 1px solid black;
          border-radius: 5px;
        }
        /* img {
          border: 1px solid black;
          border-radius: 5px;
          width: 50px;
        } */
        #idedit {
          display: none;
        }
      </style>
</head>
<body>
    <h1>user section</h1>
    <select  id="filter">
        <option value="">Filter by Genre</option>
        <option value="Science">Science</option>
        <option value="Fiction">Fiction</option>
        <option value="History">History</option>
        <option value="Tech">Tech</option>
        <option value="Business">Business</option>
        
    </select>

    <select  id="sort">
        <option value="">Sort by price</option>
        <option value="asc">Low to High</option>
        <option value="desc">High to Low</option>
    </select>
    <div id="booksContainer"></div>

    <div id="modaledit" class="modaledit">
        <button id="exit" class="exit">x</button>
        <form id="formedit">
          <input id="idedit" />
          <img id="bookImgedit"   />
          <h2 id="nameedit" ></h2>
          <p id="authoredit" ></p>
          <p id="borrowing" >John Doe</p>
          <p  id="date" ></p>
          
          <p id="publisheredit" ></p>
          <p id="priceedit" ></p>

          <input type="submit" value="Close" />
  
          <input type="submit" value="Confirm" />
        </form>
      </div>

</body>
</html>
<script>
    getData()

    let sorting=document.getElementById("sort")

    sorting.addEventListener("change",function(){

        if(sorting.value==""){
            fetch(`http://localhost:3000/books`).then((val)=>val.json()).then((data)=>{
            createDom(data)
        })
        }
        else{
            fetch(`http://localhost:3000/books?_sort=price&_order=${sorting.value}`).then((val)=>val.json()).then((data)=>{
            createDom(data)
        })
        }

       

    })

    let filtering=document.getElementById("filter")
    filtering.addEventListener("change",function(){

        if(filtering.value==""){
            fetch(`http://localhost:3000/books`).then((val)=>val.json()).then((data)=>{
            createDom(data)
        })
        }
        else{
            fetch(`http://localhost:3000/books?genre=${filtering.value}`).then((val)=>val.json()).then((data)=>{
            createDom(data)
        })
        }
       

    })

    function getData(){
        fetch("http://localhost:3000/books").then((val)=>val.json()).then((data)=>{

            createDom(data)
        })
    }

    let borrowForm = document.querySelector("#formedit");
    borrowForm.addEventListener("submit", user2);

    function user2(e){
        e.preventDefault()
        let obj = {
            id: borrowForm.idedit.value,
      borrowed: "true"
    };
    // console.log(obj)
    fetch(`http://localhost:3000/books/${obj.id}`, {
      method: `PATCH`,
      body: JSON.stringify(obj),
      headers: { "Content-type": `application/json; charset=UTF-8` },
    }).then((response) => response.json());

    }


    function createDom(data){
        document.getElementById("booksContainer").textContent=""
                data.forEach((el,i)=>{
                let div=document.createElement("div")

let bookImg=document.createElement("img")
    bookImg.src=el.bookImg
    bookImg.setAttribute("width","100px")
    bookImg.setAttribute("height","100px")

    let name=document.createElement("h2")
    name.innerText=` ${el.name}`

    let author=document.createElement("p")
    author.innerText=`Author: ${el.author}`

    let genre=document.createElement("p")
    genre.innerText=`Genre: ${el.genre}`

    let edition=document.createElement("p")
    edition.innerText=`Edition: ${el.edition}`

    let publisher=document.createElement("p")
    publisher.innerText=`Publisher: ${el.publisher}`

    let price=document.createElement("p")
    price.innerText=`Price: ${el.price}`

    let borrowed=document.createElement("button")
    borrowed.innerText="Borrow"
    borrowed.addEventListener("click",function(){
        editing(el)
    })
    

    div.append(bookImg,name,author,genre,edition,publisher,price,borrowed)
    document.getElementById("booksContainer").append(div)

    
    


            })
            }

            function editing(e){
                console.log("hi",e)
        document.getElementById("modaledit").style = "display: block";
    document.getElementById("idedit").value = e.id;
    document.getElementById("bookImgedit").src = e.bookImg;
    document.getElementById("bookImgedit").setAttribute("width","100px") 
    document.getElementById("nameedit").innerText= e.name;
    document.getElementById("authoredit").innerText = e.author;
    // document.getElementById("genreedit").value = e.genre;
    // document.getElementById("editionedit").value = e.edition;
    document.getElementById("date").textContent = new Date()
    document.getElementById("publisheredit").textContent = e.publisher;
    document.getElementById("priceedit").textContent = e.price;
    }

            var element = document.getElementById("exit");
  element.onclick = function (event) {
    document.getElementById("modaledit").style = "display: none";
  };
</script>